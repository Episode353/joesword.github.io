<!DOCTYPE html>
<html>
<head>
    <title>Scoreboard</title>
    <!-- Add the Firebase SDK scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-auth.js"></script>
    <script src="../scripts/seppe.js?v=2"></script>
    <script src="../scripts/shufflebox.js?v=2"></script>
    <script src="../scripts/back-map.js?v=2"></script>
    <script src="../scripts/firebase-megascript.js"></script>
</head>
<body>

    <!--Firebase Authenticaion Information-->
    <div class="header-login">
        <div class="account-dropdown">
            <button class="account-btn" id="accountBtn">Login</button>
            <button id="logoutBtn" style="display: none;">Logout</button>
            <div class="dropdown-content" id="dropdownContent">
                <div id="userDisplay" class="user-info" style="display:none;"></div>
            </div>
        </div>
        <div id="loginStatus" style="display: none; align-items: center;">
            <div style="width: 10px; height: 10px; background-color: green; border-radius: 50%; margin-right: 5px;"></div>
            <div id="loginStatusText" style="color: green;">Logged in</div>
        </div>
    </div>
    <div id="loginFormContainer" class="login-form-container draggable">
        <form id="loginForm">
            <h2>Login</h2>
            <input type="email" id="email" placeholder="Email" required>
            <input type="password" id="password" placeholder="Password" required>
            <button type="submit">Login</button>
        </form>
    </div>


    <h1>Scoreboard</h1>
    <table>
        <thead>
            <tr>
                <th>User</th>
                <th>Points</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="scoreboard-body">
            <!-- Data will be loaded here -->
        </tbody>
    </table>
    <form>
        <label for="username">Username:</label>
        <input type="text" id="username" required>
        <label for="points">Points:</label>
        <input type="number" id="points" required>
        <button type="button" id="submit-button">Add Score</button>
    </form>

    <script>
        

        // Reference to the Firebase Realtime Database
        var database = firebase.database();

        // Function to add or update a user's score
        function updateScore(username, points) {
            database.ref('scores').child(username).once('value', function (snapshot) {
                var userScore = snapshot.val();
                if (userScore) {
                    // Update points for existing user
                    var updatedPoints = userScore.points + points;
                    database.ref('scores').child(username).update({ points: updatedPoints });
                } else {
                    // Add new user with points
                    database.ref('scores').child(username).set({ points: points });
                }
            });
        }

        // Function to add +1 or -1 point to a user's score
        function updateScoreByOne(username, increment) {
            database.ref('scores').child(username).once('value', function (snapshot) {
                var userScore = snapshot.val();
                if (userScore) {
                    // Update points for existing user
                    var updatedPoints = userScore.points + increment;
                    database.ref('scores').child(username).update({ points: updatedPoints });
                }
            });
        }

        // Function to remove a user's score from the database
        function removeScore(username) {
            database.ref('scores').child(username).remove();
        }

        // Function to update the scoreboard on the page
        function updateScoreboard(snapshot) {
            var scoreboardBody = document.getElementById('scoreboard-body');
            scoreboardBody.innerHTML = '';

            snapshot.forEach(function (childSnapshot) {
                var score = childSnapshot.val();
                var username = childSnapshot.key; // Get the username from the snapshot key
                var row = document.createElement('tr');
                var userCell = document.createElement('td');
                var pointsCell = document.createElement('td');
                var deleteCell = document.createElement('td');
                var actionsCell = document.createElement('td'); // New cell for the +1 and -1 buttons

                var deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.setAttribute('data-username', username);
                deleteButton.addEventListener('click', function () {
                    var usernameToDelete = this.getAttribute('data-username');
                    removeScore(usernameToDelete);
                });

                var plusOneButton = document.createElement('button');
                plusOneButton.textContent = '+1';
                plusOneButton.setAttribute('data-username', username);
                plusOneButton.addEventListener('click', function () {
                    var usernameToUpdate = this.getAttribute('data-username');
                    updateScoreByOne(usernameToUpdate, 1);
                });

                var minusOneButton = document.createElement('button');
                minusOneButton.textContent = '-1';
                minusOneButton.setAttribute('data-username', username);
                minusOneButton.addEventListener('click', function () {
                    var usernameToUpdate = this.getAttribute('data-username');
                    updateScoreByOne(usernameToUpdate, -1);
                });

                userCell.textContent = username;
                pointsCell.textContent = score.points;
                deleteCell.appendChild(deleteButton);
                actionsCell.appendChild(plusOneButton);
                actionsCell.appendChild(minusOneButton);

                row.appendChild(userCell);
                row.appendChild(pointsCell);
                row.appendChild(deleteCell);
                row.appendChild(actionsCell); // Add the cell containing +1 and -1 buttons
                scoreboardBody.appendChild(row);
            });
        }

        // Event listener for the submit button
        document.getElementById('submit-button').addEventListener('click', function () {
            var username = document.getElementById('username').value;
            var points = parseInt(document.getElementById('points').value);
            updateScore(username, points);
        });

        // Listen for changes in the 'scores' node and update the scoreboard accordingly
        database.ref('scores').on('value', function (snapshot) {
            updateScoreboard(snapshot);
        });

    </script>
</body>
</html>
