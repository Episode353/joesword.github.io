<!DOCTYPE html>
<html>
<head>
    <title>Firebase Authentication Example</title>
    <!-- Include the Firebase JavaScript SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>
    <h1>Firebase Authentication Example</h1>

    <div id="login">
        <h2>Login</h2>
        <input type="email" id="email" placeholder="Email" /><br>
        <input type="password" id="password" placeholder="Password" /><br>
        <button onclick="login()">Login</button>
    </div>

    <div id="data" style="display: none;">
        <h2>Data</h2>
        <label for="name">Name:</label>
        <input type="text" id="name" /><br>

        <label for="currentHealth">Current Health:</label>
        <input type="number" id="currentHealth" /><br>

        <label for="maxHealth">Max Health:</label>
        <input type="number" id="maxHealth" /><br>

        <label for="location">Location:</label>
        <input type="text" id="location" /><br>

        <button onclick="saveData()">Save Data</button>
        <button onclick="loadData()">Load Data</button>
    </div>

    <script>
        // Initialize Firebase
        var firebaseConfig = {
            apiKey: "AIzaSyCqgWyZOOfVZddqVjV-ZsDpMo6b0F1UJxs",
            authDomain: "joesworldonline-967be.firebaseapp.com",
            databaseURL: "https://joesworldonline-967be-default-rtdb.firebaseio.com",
            projectId: "joesworldonline-967be",
            storageBucket: "joesworldonline-967be.appspot.com",
            messagingSenderId: "817241549916",
            appId: "1:817241549916:web:787af20d01f9172efaca99"
        };
        firebase.initializeApp(firebaseConfig);

        // Function to handle login
        function login() {
            var email = document.getElementById("email").value;
            var password = document.getElementById("password").value;

            firebase.auth().signInWithEmailAndPassword(email, password)
                .then(function (userCredential) {
                    // Successful login
                    console.log("User logged in");
                    loadData();
                    document.getElementById("login").style.display = "none";
                    document.getElementById("data").style.display = "block";
                })
                .catch(function (error) {
                    // Error handling
                    var errorCode = error.code;
                    var errorMessage = error.message;
                    console.log("Error: " + errorMessage);
                });
        }

        // Function to save data
        function saveData() {
            var name = document.getElementById("name").value;
            var currentHealth = parseInt(document.getElementById("currentHealth").value);
            var maxHealth = parseInt(document.getElementById("maxHealth").value);
            var location = document.getElementById("location").value;

            firebase.auth().onAuthStateChanged(function (user) {
                if (user) {
                    // User is signed in, save data under their UID
                    var uid = user.uid;
                    firebase.database().ref('dnd/users/' + uid).set({
                        name: name,
                        currentHealth: currentHealth,
                        maxHealth: maxHealth,
                        location: location
                    }).then(function () {
                        console.log("Data saved successfully");
                    }).catch(function (error) {
                        console.log("Error saving data: " + error.message);
                    });
                }
            });
        }

        // Function to load data
        function loadData() {
            firebase.auth().onAuthStateChanged(function (user) {
                if (user) {
                    // User is signed in, load data under their UID
                    var uid = user.uid;
                    firebase.database().ref('dnd/users/' + uid).once('value')
                        .then(function (snapshot) {
                            var data = snapshot.val();
                            document.getElementById("name").value = data.name || '';
                            document.getElementById("currentHealth").value = data.currentHealth || '';
                            document.getElementById("maxHealth").value = data.maxHealth || '';
                            document.getElementById("location").value = data.location || '';
                            console.log("Data loaded successfully");
                        })
                        .catch(function (error) {
                            console.log("Error loading data: " + error.message);
                        });
                }
            });
        }
    </script>
</body>
</html>
